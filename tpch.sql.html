<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; }
code > span.dt { color: #800000; }
code > span.dv { color: #0000ff; }
code > span.bn { color: #0000ff; }
code > span.fl { color: #800080; }
code > span.ch { color: #ff00ff; }
code > span.st { color: #dd0000; }
code > span.co { color: #808080; font-style: italic; }
code > span.al { color: #00ff00; font-weight: bold; }
code > span.fu { color: #000080; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>
<p>I have made two changes compared with the pristine TPC-H queries:</p>
<ul>
<li>replaced set rowcount with limit. This will be changed to the ANSI standard syntax when this is added.</li>
<li>replaced the create view/query/drop view sequence for q15 with a common table expression query.</li>
</ul>
<p>Apart from that, the query text is unchanged. The parser is able to successfully parse all these queries. See the bottom of the <a href="test_cases.html">simple-sql-parser test cases</a>.</p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- q1</span>
<span class="kw">select</span>
        l_returnflag,
        l_linestatus,
        <span class="fu">sum</span>(l_quantity) <span class="kw">as</span> sum_qty,
        <span class="fu">sum</span>(l_extendedprice) <span class="kw">as</span> sum_base_price,
        <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> sum_disc_price,
        <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount) * (<span class="dv">1</span> + l_tax)) <span class="kw">as</span> sum_charge,
        <span class="fu">avg</span>(l_quantity) <span class="kw">as</span> avg_qty,
        <span class="fu">avg</span>(l_extendedprice) <span class="kw">as</span> avg_price,
        <span class="fu">avg</span>(l_discount) <span class="kw">as</span> avg_disc,
        <span class="fu">count</span>(*) <span class="kw">as</span> count_order
<span class="kw">from</span>
        lineitem
<span class="kw">where</span>
        l_shipdate &lt;= <span class="dt">date</span> <span class="st">&#39;1998-12-01&#39;</span> - <span class="dt">interval</span> <span class="st">&#39;63&#39;</span> <span class="dt">day</span> (<span class="dv">3</span>)
<span class="kw">group</span> <span class="kw">by</span>
        l_returnflag,
        l_linestatus
<span class="kw">order</span> <span class="kw">by</span>
        l_returnflag,
        l_linestatus;

<span class="co">-- q2</span>

<span class="kw">select</span>
        s_acctbal,
        s_name,
        n_name,
        p_partkey,
        p_mfgr,
        s_address,
        s_phone,
        s_comment
<span class="kw">from</span>
        part,
        supplier,
        partsupp,
        nation,
        region
<span class="kw">where</span>
        p_partkey = ps_partkey
        <span class="kw">and</span> s_suppkey = ps_suppkey
        <span class="kw">and</span> p_size = <span class="dv">15</span>
        <span class="kw">and</span> p_type <span class="kw">like</span> <span class="st">&#39;%BRASS&#39;</span>
        <span class="kw">and</span> s_nationkey = n_nationkey
        <span class="kw">and</span> n_regionkey = r_regionkey
        <span class="kw">and</span> r_name = <span class="st">&#39;EUROPE&#39;</span>
        <span class="kw">and</span> ps_supplycost = (
                <span class="kw">select</span>
                        <span class="fu">min</span>(ps_supplycost)
                <span class="kw">from</span>
                        partsupp,
                        supplier,
                        nation,
                        region
                <span class="kw">where</span>
                        p_partkey = ps_partkey
                        <span class="kw">and</span> s_suppkey = ps_suppkey
                        <span class="kw">and</span> s_nationkey = n_nationkey
                        <span class="kw">and</span> n_regionkey = r_regionkey
                        <span class="kw">and</span> r_name = <span class="st">&#39;EUROPE&#39;</span>
        )
<span class="kw">order</span> <span class="kw">by</span>
        s_acctbal <span class="kw">desc</span>,
        n_name,
        s_name,
        p_partkey
<span class="kw">limit</span> <span class="dv">100</span>;
<span class="co">--q3</span>
<span class="kw">select</span>
        l_orderkey,
        <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> revenue,
        o_orderdate,
        o_shippriority
<span class="kw">from</span>
        customer,
        orders,
        lineitem
<span class="kw">where</span>
        c_mktsegment = <span class="st">&#39;MACHINERY&#39;</span>
        <span class="kw">and</span> c_custkey = o_custkey
        <span class="kw">and</span> l_orderkey = o_orderkey
        <span class="kw">and</span> o_orderdate &lt; <span class="dt">date</span> <span class="st">&#39;1995-03-21&#39;</span>
        <span class="kw">and</span> l_shipdate &gt; <span class="dt">date</span> <span class="st">&#39;1995-03-21&#39;</span>
<span class="kw">group</span> <span class="kw">by</span>
        l_orderkey,
        o_orderdate,
        o_shippriority
<span class="kw">order</span> <span class="kw">by</span>
        revenue <span class="kw">desc</span>,
        o_orderdate
<span class="kw">limit</span> <span class="dv">10</span>;

<span class="co">-- q4</span>
<span class="kw">select</span>
        o_orderpriority,
        <span class="fu">count</span>(*) <span class="kw">as</span> order_count
<span class="kw">from</span>
        orders
<span class="kw">where</span>
        o_orderdate &gt;= <span class="dt">date</span> <span class="st">&#39;1996-03-01&#39;</span>
        <span class="kw">and</span> o_orderdate &lt; <span class="dt">date</span> <span class="st">&#39;1996-03-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;3&#39;</span> <span class="dt">month</span>
        <span class="kw">and</span> <span class="kw">exists</span> (
                <span class="kw">select</span>
                        *
                <span class="kw">from</span>
                        lineitem
                <span class="kw">where</span>
                        l_orderkey = o_orderkey
                        <span class="kw">and</span> l_commitdate &lt; l_receiptdate
        )
<span class="kw">group</span> <span class="kw">by</span>
        o_orderpriority
<span class="kw">order</span> <span class="kw">by</span>
        o_orderpriority;
<span class="co">--q5</span>
<span class="kw">select</span>
        n_name,
        <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> revenue
<span class="kw">from</span>
        customer,
        orders,
        lineitem,
        supplier,
        nation,
        region
<span class="kw">where</span>
        c_custkey = o_custkey
        <span class="kw">and</span> l_orderkey = o_orderkey
        <span class="kw">and</span> l_suppkey = s_suppkey
        <span class="kw">and</span> c_nationkey = s_nationkey
        <span class="kw">and</span> s_nationkey = n_nationkey
        <span class="kw">and</span> n_regionkey = r_regionkey
        <span class="kw">and</span> r_name = <span class="st">&#39;EUROPE&#39;</span>
        <span class="kw">and</span> o_orderdate &gt;= <span class="dt">date</span> <span class="st">&#39;1997-01-01&#39;</span>
        <span class="kw">and</span> o_orderdate &lt; <span class="dt">date</span> <span class="st">&#39;1997-01-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;1&#39;</span> <span class="dt">year</span>
<span class="kw">group</span> <span class="kw">by</span>
        n_name
<span class="kw">order</span> <span class="kw">by</span>
        revenue <span class="kw">desc</span>;

<span class="co">-- q6</span>

<span class="kw">select</span>
        <span class="fu">sum</span>(l_extendedprice * l_discount) <span class="kw">as</span> revenue
<span class="kw">from</span>
        lineitem
<span class="kw">where</span>
        l_shipdate &gt;= <span class="dt">date</span> <span class="st">&#39;1997-01-01&#39;</span>
        <span class="kw">and</span> l_shipdate &lt; <span class="dt">date</span> <span class="st">&#39;1997-01-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;1&#39;</span> <span class="dt">year</span>
        <span class="kw">and</span> l_discount <span class="kw">between</span> <span class="fl">0.07</span> - <span class="fl">0.01</span> <span class="kw">and</span> <span class="fl">0.07</span> + <span class="fl">0.01</span>
        <span class="kw">and</span> l_quantity &lt; <span class="dv">24</span>;

<span class="co">--q7</span>
<span class="kw">select</span>
        supp_nation,
        cust_nation,
        l_year,
        <span class="fu">sum</span>(volume) <span class="kw">as</span> revenue
<span class="kw">from</span>
        (
                <span class="kw">select</span>
                        n1.n_name <span class="kw">as</span> supp_nation,
                        n2.n_name <span class="kw">as</span> cust_nation,
                        <span class="fu">extract</span>(<span class="dt">year</span> <span class="kw">from</span> l_shipdate) <span class="kw">as</span> l_year,
                        l_extendedprice * (<span class="dv">1</span> - l_discount) <span class="kw">as</span> volume
                <span class="kw">from</span>
                        supplier,
                        lineitem,
                        orders,
                        customer,
                        nation n1,
                        nation n2
                <span class="kw">where</span>
                        s_suppkey = l_suppkey
                        <span class="kw">and</span> o_orderkey = l_orderkey
                        <span class="kw">and</span> c_custkey = o_custkey
                        <span class="kw">and</span> s_nationkey = n1.n_nationkey
                        <span class="kw">and</span> c_nationkey = n2.n_nationkey
                        <span class="kw">and</span> (
                                (n1.n_name = <span class="st">&#39;PERU&#39;</span> <span class="kw">and</span> n2.n_name = <span class="st">&#39;IRAQ&#39;</span>)
                                <span class="kw">or</span> (n1.n_name = <span class="st">&#39;IRAQ&#39;</span> <span class="kw">and</span> n2.n_name = <span class="st">&#39;PERU&#39;</span>)
                        )
                        <span class="kw">and</span> l_shipdate <span class="kw">between</span> <span class="dt">date</span> <span class="st">&#39;1995-01-01&#39;</span> <span class="kw">and</span> <span class="dt">date</span> <span class="st">&#39;1996-12-31&#39;</span>
        ) <span class="kw">as</span> shipping
<span class="kw">group</span> <span class="kw">by</span>
        supp_nation,
        cust_nation,
        l_year
<span class="kw">order</span> <span class="kw">by</span>
        supp_nation,
        cust_nation,
        l_year;
<span class="co">-- q8</span>
<span class="kw">select</span>
        o_year,
        <span class="fu">sum</span>(<span class="kw">case</span>
                <span class="kw">when</span> nation = <span class="st">&#39;IRAQ&#39;</span> <span class="kw">then</span> volume
                <span class="kw">else</span> <span class="dv">0</span>
        <span class="kw">end</span>) / <span class="fu">sum</span>(volume) <span class="kw">as</span> mkt_share
<span class="kw">from</span>
        (
                <span class="kw">select</span>
                        <span class="fu">extract</span>(<span class="dt">year</span> <span class="kw">from</span> o_orderdate) <span class="kw">as</span> o_year,
                        l_extendedprice * (<span class="dv">1</span> - l_discount) <span class="kw">as</span> volume,
                        n2.n_name <span class="kw">as</span> nation
                <span class="kw">from</span>
                        part,
                        supplier,
                        lineitem,
                        orders,
                        customer,
                        nation n1,
                        nation n2,
                        region
                <span class="kw">where</span>
                        p_partkey = l_partkey
                        <span class="kw">and</span> s_suppkey = l_suppkey
                        <span class="kw">and</span> l_orderkey = o_orderkey
                        <span class="kw">and</span> o_custkey = c_custkey
                        <span class="kw">and</span> c_nationkey = n1.n_nationkey
                        <span class="kw">and</span> n1.n_regionkey = r_regionkey
                        <span class="kw">and</span> r_name = <span class="st">&#39;MIDDLE EAST&#39;</span>
                        <span class="kw">and</span> s_nationkey = n2.n_nationkey
                        <span class="kw">and</span> o_orderdate <span class="kw">between</span> <span class="dt">date</span> <span class="st">&#39;1995-01-01&#39;</span> <span class="kw">and</span> <span class="dt">date</span> <span class="st">&#39;1996-12-31&#39;</span>
                        <span class="kw">and</span> p_type = <span class="st">&#39;STANDARD ANODIZED BRASS&#39;</span>
        ) <span class="kw">as</span> all_nations
<span class="kw">group</span> <span class="kw">by</span>
        o_year
<span class="kw">order</span> <span class="kw">by</span>
        o_year;
<span class="co">-- q9</span>

<span class="kw">select</span>
        nation,
        o_year,
        <span class="fu">sum</span>(amount) <span class="kw">as</span> sum_profit
<span class="kw">from</span>
        (
                <span class="kw">select</span>
                        n_name <span class="kw">as</span> nation,
                        <span class="fu">extract</span>(<span class="dt">year</span> <span class="kw">from</span> o_orderdate) <span class="kw">as</span> o_year,
                        l_extendedprice * (<span class="dv">1</span> - l_discount) - ps_supplycost * l_quantity <span class="kw">as</span> amount
                <span class="kw">from</span>
                        part,
                        supplier,
                        lineitem,
                        partsupp,
                        orders,
                        nation
                <span class="kw">where</span>
                        s_suppkey = l_suppkey
                        <span class="kw">and</span> ps_suppkey = l_suppkey
                        <span class="kw">and</span> ps_partkey = l_partkey
                        <span class="kw">and</span> p_partkey = l_partkey
                        <span class="kw">and</span> o_orderkey = l_orderkey
                        <span class="kw">and</span> s_nationkey = n_nationkey
                        <span class="kw">and</span> p_name <span class="kw">like</span> <span class="st">&#39;%antique%&#39;</span>
        ) <span class="kw">as</span> profit
<span class="kw">group</span> <span class="kw">by</span>
        nation,
        o_year
<span class="kw">order</span> <span class="kw">by</span>
        nation,
        o_year <span class="kw">desc</span>;
<span class="co">-- q10</span>

<span class="kw">select</span>
        c_custkey,
        c_name,
        <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> revenue,
        c_acctbal,
        n_name,
        c_address,
        c_phone,
        c_comment
<span class="kw">from</span>
        customer,
        orders,
        lineitem,
        nation
<span class="kw">where</span>
        c_custkey = o_custkey
        <span class="kw">and</span> l_orderkey = o_orderkey
        <span class="kw">and</span> o_orderdate &gt;= <span class="dt">date</span> <span class="st">&#39;1993-12-01&#39;</span>
        <span class="kw">and</span> o_orderdate &lt; <span class="dt">date</span> <span class="st">&#39;1993-12-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;3&#39;</span> <span class="dt">month</span>
        <span class="kw">and</span> l_returnflag = <span class="st">&#39;R&#39;</span>
        <span class="kw">and</span> c_nationkey = n_nationkey
<span class="kw">group</span> <span class="kw">by</span>
        c_custkey,
        c_name,
        c_acctbal,
        c_phone,
        n_name,
        c_address,
        c_comment
<span class="kw">order</span> <span class="kw">by</span>
        revenue <span class="kw">desc</span>
<span class="kw">limit</span> <span class="dv">20</span>;

<span class="co">-- q11</span>
<span class="kw">select</span>
        ps_partkey,
        <span class="fu">sum</span>(ps_supplycost * ps_availqty) <span class="kw">as</span> <span class="fu">value</span>
<span class="kw">from</span>
        partsupp,
        supplier,
        nation
<span class="kw">where</span>
        ps_suppkey = s_suppkey
        <span class="kw">and</span> s_nationkey = n_nationkey
        <span class="kw">and</span> n_name = <span class="st">&#39;CHINA&#39;</span>
<span class="kw">group</span> <span class="kw">by</span>
        ps_partkey <span class="kw">having</span>
                <span class="fu">sum</span>(ps_supplycost * ps_availqty) &gt; (
                        <span class="kw">select</span>
                                <span class="fu">sum</span>(ps_supplycost * ps_availqty) * <span class="fl">0.0001000000</span>
                        <span class="kw">from</span>
                                partsupp,
                                supplier,
                                nation
                        <span class="kw">where</span>
                                ps_suppkey = s_suppkey
                                <span class="kw">and</span> s_nationkey = n_nationkey
                                <span class="kw">and</span> n_name = <span class="st">&#39;CHINA&#39;</span>
                )
<span class="kw">order</span> <span class="kw">by</span>
        <span class="fu">value</span> <span class="kw">desc</span>;
<span class="co">-- q12</span>

<span class="kw">select</span>
        l_shipmode,
        <span class="fu">sum</span>(<span class="kw">case</span>
                <span class="kw">when</span> o_orderpriority = <span class="st">&#39;1-URGENT&#39;</span>
                        <span class="kw">or</span> o_orderpriority = <span class="st">&#39;2-HIGH&#39;</span>
                        <span class="kw">then</span> <span class="dv">1</span>
                <span class="kw">else</span> <span class="dv">0</span>
        <span class="kw">end</span>) <span class="kw">as</span> high_line_count,
        <span class="fu">sum</span>(<span class="kw">case</span>
                <span class="kw">when</span> o_orderpriority &lt;&gt; <span class="st">&#39;1-URGENT&#39;</span>
                        <span class="kw">and</span> o_orderpriority &lt;&gt; <span class="st">&#39;2-HIGH&#39;</span>
                        <span class="kw">then</span> <span class="dv">1</span>
                <span class="kw">else</span> <span class="dv">0</span>
        <span class="kw">end</span>) <span class="kw">as</span> low_line_count
<span class="kw">from</span>
        orders,
        lineitem
<span class="kw">where</span>
        o_orderkey = l_orderkey
        <span class="kw">and</span> l_shipmode <span class="kw">in</span> (<span class="st">&#39;AIR&#39;</span>, <span class="st">&#39;RAIL&#39;</span>)
        <span class="kw">and</span> l_commitdate &lt; l_receiptdate
        <span class="kw">and</span> l_shipdate &lt; l_commitdate
        <span class="kw">and</span> l_receiptdate &gt;= <span class="dt">date</span> <span class="st">&#39;1994-01-01&#39;</span>
        <span class="kw">and</span> l_receiptdate &lt; <span class="dt">date</span> <span class="st">&#39;1994-01-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;1&#39;</span> <span class="dt">year</span>
<span class="kw">group</span> <span class="kw">by</span>
        l_shipmode
<span class="kw">order</span> <span class="kw">by</span>
        l_shipmode;

<span class="co">-- q13</span>

<span class="kw">select</span>
        c_count,
        <span class="fu">count</span>(*) <span class="kw">as</span> custdist
<span class="kw">from</span>
        (
                <span class="kw">select</span>
                        c_custkey,
                        <span class="fu">count</span>(o_orderkey)
                <span class="kw">from</span>
                        customer <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> orders <span class="kw">on</span>
                                c_custkey = o_custkey
                                <span class="kw">and</span> o_comment <span class="kw">not</span> <span class="kw">like</span> <span class="st">&#39;%pending%requests%&#39;</span>
                <span class="kw">group</span> <span class="kw">by</span>
                        c_custkey
        ) <span class="kw">as</span> c_orders (c_custkey, c_count)
<span class="kw">group</span> <span class="kw">by</span>
        c_count
<span class="kw">order</span> <span class="kw">by</span>
        custdist <span class="kw">desc</span>,
        c_count <span class="kw">desc</span>;

<span class="co">-- q14</span>

<span class="kw">select</span>
        <span class="fl">100.00</span> * <span class="fu">sum</span>(<span class="kw">case</span>
                <span class="kw">when</span> p_type <span class="kw">like</span> <span class="st">&#39;PROMO%&#39;</span>
                        <span class="kw">then</span> l_extendedprice * (<span class="dv">1</span> - l_discount)
                <span class="kw">else</span> <span class="dv">0</span>
        <span class="kw">end</span>) / <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> promo_revenue
<span class="kw">from</span>
        lineitem,
        part
<span class="kw">where</span>
        l_partkey = p_partkey
        <span class="kw">and</span> l_shipdate &gt;= <span class="dt">date</span> <span class="st">&#39;1994-12-01&#39;</span>
        <span class="kw">and</span> l_shipdate &lt; <span class="dt">date</span> <span class="st">&#39;1994-12-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;1&#39;</span> <span class="dt">month</span>;

<span class="co">-- q15</span>
<span class="co">/*create view revenue0 (supplier_no, total_revenue) as</span>
<span class="co">        select</span>
<span class="co">                l_suppkey,</span>
<span class="co">                sum(l_extendedprice * (1 - l_discount))</span>
<span class="co">        from</span>
<span class="co">                lineitem</span>
<span class="co">        where</span>
<span class="co">                l_shipdate &gt;= date &#39;1995-06-01&#39;</span>
<span class="co">                and l_shipdate &lt; date &#39;1995-06-01&#39; + interval &#39;3&#39; month</span>
<span class="co">        group by</span>
<span class="co">                l_suppkey;*/</span>

<span class="kw">with</span>
revenue0 <span class="kw">as</span>
        (<span class="kw">select</span>
                l_suppkey <span class="kw">as</span> supplier_no,
                <span class="fu">sum</span>(l_extendedprice * (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> total_revenue
        <span class="kw">from</span>
                lineitem
        <span class="kw">where</span>
                l_shipdate &gt;= <span class="dt">date</span> <span class="st">&#39;1995-06-01&#39;</span>
                <span class="kw">and</span> l_shipdate &lt; <span class="dt">date</span> <span class="st">&#39;1995-06-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;3&#39;</span> <span class="dt">month</span>
        <span class="kw">group</span> <span class="kw">by</span>
                l_suppkey)
<span class="kw">select</span>
        s_suppkey,
        s_name,
        s_address,
        s_phone,
        total_revenue
<span class="kw">from</span>
        supplier,
        revenue0
<span class="kw">where</span>
        s_suppkey = supplier_no
        <span class="kw">and</span> total_revenue = (
                <span class="kw">select</span>
                        <span class="fu">max</span>(total_revenue)
                <span class="kw">from</span>
                        revenue0
        )
<span class="kw">order</span> <span class="kw">by</span>
        s_suppkey;

<span class="co">-- q16</span>

<span class="kw">select</span>
        p_brand,
        p_type,
        p_size,
        <span class="fu">count</span>(<span class="kw">distinct</span> ps_suppkey) <span class="kw">as</span> supplier_cnt
<span class="kw">from</span>
        partsupp,
        part
<span class="kw">where</span>
        p_partkey = ps_partkey
        <span class="kw">and</span> p_brand &lt;&gt; <span class="st">&#39;Brand#15&#39;</span>
        <span class="kw">and</span> p_type <span class="kw">not</span> <span class="kw">like</span> <span class="st">&#39;MEDIUM BURNISHED%&#39;</span>
        <span class="kw">and</span> p_size <span class="kw">in</span> (<span class="dv">39</span>, <span class="dv">26</span>, <span class="dv">18</span>, <span class="dv">45</span>, <span class="dv">19</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">9</span>)
        <span class="kw">and</span> ps_suppkey <span class="kw">not</span> <span class="kw">in</span> (
                <span class="kw">select</span>
                        s_suppkey
                <span class="kw">from</span>
                        supplier
                <span class="kw">where</span>
                        s_comment <span class="kw">like</span> <span class="st">&#39;%Customer%Complaints%&#39;</span>
        )
<span class="kw">group</span> <span class="kw">by</span>
        p_brand,
        p_type,
        p_size
<span class="kw">order</span> <span class="kw">by</span>
        supplier_cnt <span class="kw">desc</span>,
        p_brand,
        p_type,
        p_size;

<span class="co">-- q17</span>

<span class="kw">select</span>
        <span class="fu">sum</span>(l_extendedprice) / <span class="fl">7.0</span> <span class="kw">as</span> avg_yearly
<span class="kw">from</span>
        lineitem,
        part
<span class="kw">where</span>
        p_partkey = l_partkey
        <span class="kw">and</span> p_brand = <span class="st">&#39;Brand#52&#39;</span>
        <span class="kw">and</span> p_container = <span class="st">&#39;JUMBO CAN&#39;</span>
        <span class="kw">and</span> l_quantity &lt; (
                <span class="kw">select</span>
                        <span class="fl">0.2</span> * <span class="fu">avg</span>(l_quantity)
                <span class="kw">from</span>
                        lineitem
                <span class="kw">where</span>
                        l_partkey = p_partkey
        );

<span class="co">-- q18</span>
<span class="kw">select</span>
        c_name,
        c_custkey,
        o_orderkey,
        o_orderdate,
        o_totalprice,
        <span class="fu">sum</span>(l_quantity)
<span class="kw">from</span>
        customer,
        orders,
        lineitem
<span class="kw">where</span>
        o_orderkey <span class="kw">in</span> (
                <span class="kw">select</span>
                        l_orderkey
                <span class="kw">from</span>
                        lineitem
                <span class="kw">group</span> <span class="kw">by</span>
                        l_orderkey <span class="kw">having</span>
                                <span class="fu">sum</span>(l_quantity) &gt; <span class="dv">313</span>
        )
        <span class="kw">and</span> c_custkey = o_custkey
        <span class="kw">and</span> o_orderkey = l_orderkey
<span class="kw">group</span> <span class="kw">by</span>
        c_name,
        c_custkey,
        o_orderkey,
        o_orderdate,
        o_totalprice
<span class="kw">order</span> <span class="kw">by</span>
        o_totalprice <span class="kw">desc</span>,
        o_orderdate
<span class="kw">limit</span> <span class="dv">100</span>;

<span class="co">-- q19</span>
<span class="kw">select</span>
        <span class="fu">sum</span>(l_extendedprice* (<span class="dv">1</span> - l_discount)) <span class="kw">as</span> revenue
<span class="kw">from</span>
        lineitem,
        part
<span class="kw">where</span>
        (
                p_partkey = l_partkey
                <span class="kw">and</span> p_brand = <span class="st">&#39;Brand#43&#39;</span>
                <span class="kw">and</span> p_container <span class="kw">in</span> (<span class="st">&#39;SM CASE&#39;</span>, <span class="st">&#39;SM BOX&#39;</span>, <span class="st">&#39;SM PACK&#39;</span>, <span class="st">&#39;SM PKG&#39;</span>)
                <span class="kw">and</span> l_quantity &gt;= <span class="dv">3</span> <span class="kw">and</span> l_quantity &lt;= <span class="dv">3</span> + <span class="dv">10</span>
                <span class="kw">and</span> p_size <span class="kw">between</span> <span class="dv">1</span> <span class="kw">and</span> <span class="dv">5</span>
                <span class="kw">and</span> l_shipmode <span class="kw">in</span> (<span class="st">&#39;AIR&#39;</span>, <span class="st">&#39;AIR REG&#39;</span>)
                <span class="kw">and</span> l_shipinstruct = <span class="st">&#39;DELIVER IN PERSON&#39;</span>
        )
        <span class="kw">or</span>
        (
                p_partkey = l_partkey
                <span class="kw">and</span> p_brand = <span class="st">&#39;Brand#25&#39;</span>
                <span class="kw">and</span> p_container <span class="kw">in</span> (<span class="st">&#39;MED BAG&#39;</span>, <span class="st">&#39;MED BOX&#39;</span>, <span class="st">&#39;MED PKG&#39;</span>, <span class="st">&#39;MED PACK&#39;</span>)
                <span class="kw">and</span> l_quantity &gt;= <span class="dv">10</span> <span class="kw">and</span> l_quantity &lt;= <span class="dv">10</span> + <span class="dv">10</span>
                <span class="kw">and</span> p_size <span class="kw">between</span> <span class="dv">1</span> <span class="kw">and</span> <span class="dv">10</span>
                <span class="kw">and</span> l_shipmode <span class="kw">in</span> (<span class="st">&#39;AIR&#39;</span>, <span class="st">&#39;AIR REG&#39;</span>)
                <span class="kw">and</span> l_shipinstruct = <span class="st">&#39;DELIVER IN PERSON&#39;</span>
        )
        <span class="kw">or</span>
        (
                p_partkey = l_partkey
                <span class="kw">and</span> p_brand = <span class="st">&#39;Brand#24&#39;</span>
                <span class="kw">and</span> p_container <span class="kw">in</span> (<span class="st">&#39;LG CASE&#39;</span>, <span class="st">&#39;LG BOX&#39;</span>, <span class="st">&#39;LG PACK&#39;</span>, <span class="st">&#39;LG PKG&#39;</span>)
                <span class="kw">and</span> l_quantity &gt;= <span class="dv">22</span> <span class="kw">and</span> l_quantity &lt;= <span class="dv">22</span> + <span class="dv">10</span>
                <span class="kw">and</span> p_size <span class="kw">between</span> <span class="dv">1</span> <span class="kw">and</span> <span class="dv">15</span>
                <span class="kw">and</span> l_shipmode <span class="kw">in</span> (<span class="st">&#39;AIR&#39;</span>, <span class="st">&#39;AIR REG&#39;</span>)
                <span class="kw">and</span> l_shipinstruct = <span class="st">&#39;DELIVER IN PERSON&#39;</span>
        );

<span class="co">-- q20</span>
<span class="kw">select</span>
        s_name,
        s_address
<span class="kw">from</span>
        supplier,
        nation
<span class="kw">where</span>
        s_suppkey <span class="kw">in</span> (
                <span class="kw">select</span>
                        ps_suppkey
                <span class="kw">from</span>
                        partsupp
                <span class="kw">where</span>
                        ps_partkey <span class="kw">in</span> (
                                <span class="kw">select</span>
                                        p_partkey
                                <span class="kw">from</span>
                                        part
                                <span class="kw">where</span>
                                        p_name <span class="kw">like</span> <span class="st">&#39;lime%&#39;</span>
                        )
                        <span class="kw">and</span> ps_availqty &gt; (
                                <span class="kw">select</span>
                                        <span class="fl">0.5</span> * <span class="fu">sum</span>(l_quantity)
                                <span class="kw">from</span>
                                        lineitem
                                <span class="kw">where</span>
                                        l_partkey = ps_partkey
                                        <span class="kw">and</span> l_suppkey = ps_suppkey
                                        <span class="kw">and</span> l_shipdate &gt;= <span class="dt">date</span> <span class="st">&#39;1994-01-01&#39;</span>
                                        <span class="kw">and</span> l_shipdate &lt; <span class="dt">date</span> <span class="st">&#39;1994-01-01&#39;</span> + <span class="dt">interval</span> <span class="st">&#39;1&#39;</span> <span class="dt">year</span>
                        )
        )
        <span class="kw">and</span> s_nationkey = n_nationkey
        <span class="kw">and</span> n_name = <span class="st">&#39;VIETNAM&#39;</span>
<span class="kw">order</span> <span class="kw">by</span>
        s_name;

<span class="co">-- q21</span>
<span class="kw">select</span>
        s_name,
        <span class="fu">count</span>(*) <span class="kw">as</span> numwait
<span class="kw">from</span>
        supplier,
        lineitem l1,
        orders,
        nation
<span class="kw">where</span>
        s_suppkey = l1.l_suppkey
        <span class="kw">and</span> o_orderkey = l1.l_orderkey
        <span class="kw">and</span> o_orderstatus = <span class="st">&#39;F&#39;</span>
        <span class="kw">and</span> l1.l_receiptdate &gt; l1.l_commitdate
        <span class="kw">and</span> <span class="kw">exists</span> (
                <span class="kw">select</span>
                        *
                <span class="kw">from</span>
                        lineitem l2
                <span class="kw">where</span>
                        l2.l_orderkey = l1.l_orderkey
                        <span class="kw">and</span> l2.l_suppkey &lt;&gt; l1.l_suppkey
        )
        <span class="kw">and</span> <span class="kw">not</span> <span class="kw">exists</span> (
                <span class="kw">select</span>
                        *
                <span class="kw">from</span>
                        lineitem l3
                <span class="kw">where</span>
                        l3.l_orderkey = l1.l_orderkey
                        <span class="kw">and</span> l3.l_suppkey &lt;&gt; l1.l_suppkey
                        <span class="kw">and</span> l3.l_receiptdate &gt; l3.l_commitdate
        )
        <span class="kw">and</span> s_nationkey = n_nationkey
        <span class="kw">and</span> n_name = <span class="st">&#39;INDIA&#39;</span>
<span class="kw">group</span> <span class="kw">by</span>
        s_name
<span class="kw">order</span> <span class="kw">by</span>
        numwait <span class="kw">desc</span>,
        s_name
<span class="kw">limit</span> <span class="dv">100</span>;

<span class="co">-- q22</span>

<span class="kw">select</span>
        cntrycode,
        <span class="fu">count</span>(*) <span class="kw">as</span> numcust,
        <span class="fu">sum</span>(c_acctbal) <span class="kw">as</span> totacctbal
<span class="kw">from</span>
        (
                <span class="kw">select</span>
                        substring(c_phone <span class="kw">from</span> <span class="dv">1</span> <span class="kw">for</span> <span class="dv">2</span>) <span class="kw">as</span> cntrycode,
                        c_acctbal
                <span class="kw">from</span>
                        customer
                <span class="kw">where</span>
                        substring(c_phone <span class="kw">from</span> <span class="dv">1</span> <span class="kw">for</span> <span class="dv">2</span>) <span class="kw">in</span>
                                (<span class="st">&#39;41&#39;</span>, <span class="st">&#39;28&#39;</span>, <span class="st">&#39;39&#39;</span>, <span class="st">&#39;21&#39;</span>, <span class="st">&#39;24&#39;</span>, <span class="st">&#39;29&#39;</span>, <span class="st">&#39;44&#39;</span>)
                        <span class="kw">and</span> c_acctbal &gt; (
                                <span class="kw">select</span>
                                        <span class="fu">avg</span>(c_acctbal)
                                <span class="kw">from</span>
                                        customer
                                <span class="kw">where</span>
                                        c_acctbal &gt; <span class="fl">0.00</span>
                                        <span class="kw">and</span> substring(c_phone <span class="kw">from</span> <span class="dv">1</span> <span class="kw">for</span> <span class="dv">2</span>) <span class="kw">in</span>
                                                (<span class="st">&#39;41&#39;</span>, <span class="st">&#39;28&#39;</span>, <span class="st">&#39;39&#39;</span>, <span class="st">&#39;21&#39;</span>, <span class="st">&#39;24&#39;</span>, <span class="st">&#39;29&#39;</span>, <span class="st">&#39;44&#39;</span>)
                        )
                        <span class="kw">and</span> <span class="kw">not</span> <span class="kw">exists</span> (
                                <span class="kw">select</span>
                                        *
                                <span class="kw">from</span>
                                        orders
                                <span class="kw">where</span>
                                        o_custkey = c_custkey
                        )
        ) <span class="kw">as</span> custsale
<span class="kw">group</span> <span class="kw">by</span>
        cntrycode
<span class="kw">order</span> <span class="kw">by</span>
        cntrycode;</code></pre>
</body>
</html>
